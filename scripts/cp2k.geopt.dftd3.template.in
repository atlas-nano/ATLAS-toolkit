@SET SAVE_FREQ  1
@SET LA LA_HERE
@SET LB LB_HERE
@SET LC LC_HERE
@SET ALPHA ALPHA_HERE
@SET BETA BETA_HERE
@SET GAMMA GAMMA_HERE
@SET PREFIX PREFIX_HERE
@SET ITER 250
@SET TSTEP 0.5
@SET CP2K_HOME /global/home/users/tpascal/codes/cp2k/cp2k

&GLOBAL
 PRINT_LEVEL low
 PROJECT ${PREFIX}
 RUN_TYPE GEO_OPT
 WALLTIME 36000000
&END GLOBAL

&MOTION
 &PRINT
  &TRAJECTORY
   FILENAME ./${PREFIX}
   FORMAT XYZ
   &EACH
     GEO_OPT ${SAVE_FREQ}
   &END EACH
  &END TRAJECTORY
 &END PRINT

 &GEO_OPT
  MAX_ITER ${ITER}
  TYPE MINIMIZATION
  MINIMIZER BFGS
 &END GEO_OPT
&END MOTION

&FORCE_EVAL
 METHOD Quickstep
 &DFT
  CHARGE 0
  MULTIPLICITY 1
  WFN_RESTART_FILE_NAME ${PREFIX}-RESTART.wfn
  BASIS_SET_FILE_NAME ${CP2K_HOME}/data/GTH_BASIS_SETS
  POTENTIAL_FILE_NAME ${CP2K_HOME}/data/GTH_POTENTIALS
  &MGRID
   CUTOFF [Ry] 500
   NGRIDS 7
  &END MGRID
  &PRINT
   &MULLIKEN
    FILENAME ./${PREFIX}
    &EACH
     GEO_OPT 1
    &END EACH
   &END MULLIKEN
  &END PRINT

  &QS
   EPS_DEFAULT 1.0E-12
   EXTRAPOLATION ASPC
   EXTRAPOLATION_ORDER 4
   MAP_CONSISTENT
   METHOD GPW
  &END QS
  &SCF
   EPS_SCF 1.0E-5
   MAX_SCF 50
   SCF_GUESS ATOMIC

   &OUTER_SCF
    EPS_SCF 1.0E-5
    MAX_SCF 20
   &END OUTER_SCF

   &OT
    MINIMIZER DIIS
    PRECONDITIONER FULL_ALL
   &END OT   
  &END SCF
  &XC
   &XC_FUNCTIONAL PBE
    &PBE
     PARAMETRIZATION REVPBE
    &END PBE
   &END XC_FUNCTIONAL

   &XC_GRID
    XC_SMOOTH_RHO NN10
    XC_DERIV SPLINE2_SMOOTH
   &END XC_GRID

   &vdW_POTENTIAL
     DISPERSION_FUNCTIONAL PAIR_POTENTIAL
     &PAIR_POTENTIAL
       TYPE DFTD3
       CALCULATE_C9_TERM .TRUE.
       REFERENCE_C9_TERM .TRUE.
       PARAMETER_FILE_NAME ${CP2K_HOME}/data/dftd3.dat
       VERBOSE_OUTPUT
       REFERENCE_FUNCTIONAL revPBE
       R_CUTOFF 8.
       EPS_CN 0.01
     &END PAIR_POTENTIAL
   &END vdW_POTENTIAL
  &END XC

  &POISSON
   PERIODIC XYZ
   POISSON_SOLVER PERIODIC
  &END POISSON
 &END DFT
 &SUBSYS
  &CELL
   ABC ${LA} ${LB} ${LC}
   ALPHA_BETA_GAMMA ${ALPHA} ${BETA} ${GAMMA}
   PERIODIC XYZ
  &END CELL
  &COORD
   @INCLUDE ${PREFIX}.cp2k.xyz
  &END COORD
  KIND_HERE
 &END SUBSYS
 STRESS_TENSOR ANALYTICAL
&END FORCE_EVAL
